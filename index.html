<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <!-- <meta http-equiv="Expires" content="0">
    <meta http-equiv="Last-Modified" content="0">
    <meta http-equiv="Cache-Control" content="no-cache, mustrevalidate">
    <meta http-equiv="Pragma" content="no-cache"> -->
</head>

<body>
    
    <div class="container">
        <div class="row">
            <div class="col">
                <!-- <input type="hidden" name="suuid" id="suuid" value="{{ .suuid }}">
                <input type="hidden" name="port" id="port" value="{{ .port }}"> -->
                <video id="livestream" style="width:600px;" controls autoplay muted></video>
                <button onclick="play()">Play</button>
                <button onclick="window.player.stop()">Stop</button>
            </div>
        </div>
    </div>
    
    <script src="index.js"></script>
    <!-- <script src="FlussonicMsePlayer.js"></script>

    <script>
        window.onload = function() {
            let element = document.getElementById("livestream");
            let opts = {
                debug: true,
                
            };
            let streamUrl = "ws://127.0.0.1:3001";
            let url = (window.location.protocol == "https:" ? "wss:" : "ws:") + '//' +window.location.host+ ':3001/';
            // console.log(window.location.host);
            window.player = new FlussonicMsePlayer(element, url, opts);

            
            // console.log(window.player.ws);
            // console.log(window.player.replaceHttpByWS());
            window.player.onMessage = (event) => {
                console.log(event);
            }
            let videotrack = 'videotrack';
            let audiotrack = 'audiotrack';
            window.player.play();
            // console.log(window.player.getVideoTracks());
            element.style.display = 'flex';
            
            // window.play = (videotrack = undefined, audiotrack) => {
            //     if (!videotrack) {
            //         audiotrack = undefined;
            //     }
            //     window.player
            //         .play(videotrack, audiotrack)
            //         .then((success) => {
            //         console.log('resolve', success);
            //     })
            //         .catch((err) => {
            //         console.log(err);
            //     });
            // };

            window.onMediaInfo = (rawMetaData) => {
                console.log(rawMetaData);
                var videoTracks = window.player.getVideoTracks()
                var audioTracks = window.player.getAudioTracks()
                var videoOptions = videoTracks.map((v, i) => (
                    `<option value="${v['track_id']}">${v['bitrate']} ${v['codec']} ${v['fps']} ${v['width']}x${v['height']}</option>`
                ))

                var audioOptions = audioTracks.map(v => (
                    `<option value="${v['track_id']}">${v['bitrate']} ${v['codec']} ${v['lang']}</option>`
                ))

                mbrControls.style.display = 'block'
            }

            window.setTracks = () => {
                var videoTrackId = window.player.getVideoTracks();
                var audioTrackId = window.player.getAudioTracks();

                window.player.setTracks([videoTrackId, audioTrackId])
            }
        }
    </script> -->
</body>

</html>
